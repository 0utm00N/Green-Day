{% extends "core/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/carrito.css' %}">
{% endblock %}

{% block content %}
{% if productos %}
<div class="carrito">
    {% for producto in productos %}
    <div class="carrito-item" id="item-{{ producto.id }}">
        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}">
        <div class="carrito-item-details">
            <h3>{{ producto.nombre }}</h3>
            <p>Cantidad: {{ producto.cantidad }}</p>
            <p>Subtotal: ${{ producto.subtotal }}</p>
        </div>
        <div class="carrito-item-actions">
            <button class="btn-eliminar" data-id="{{ producto.id }}">‚ùå Eliminar</button>
        </div>
    </div>
    {% endfor %}

    <div class="carrito-total">
        <strong>Total: ${{ total }}</strong>
    </div>

    <!-- Selecci√≥n de m√©todo de pago -->
    <h3>Seleccione su m√©todo de pago:</h3>

    <label class="opcion">
        <input type="radio" name="metodo_pago" value="transbank" class="input-pago">
        Transbank
    </label><br>

    <label class="opcion">
        <input type="radio" name="metodo_pago" value="paypal" class="input-pago">
        PayPal
    </label>

    <br><br>

    <h3>¬øC√≥mo deseas recibir tu pedido?</h3>

    <label class="opcion">
        <input type="radio" name="metodo_entrega" value="despacho" class="input-entrega">
        üöö Despacho a domicilio
    </label><br>

    <label class="opcion">
        <input type="radio" name="metodo_entrega" value="retiro" class="input-entrega">
        üõçÔ∏è Retiro en tienda
    </label>

    <br><br>

    <div id="bloque-direccion" class="hidden bloque-extra">
        <h3>Direcci√≥n de despacho</h3>

        <label class="opcion">
            <input type="radio" name="direccion_tipo" value="guardada" class="input-direccion">
            Usar mi direcci√≥n registrada: <strong>{{ request.user.cliente.direccion }}</strong>
        </label><br>

        <label class="opcion">
            <input type="radio" name="direccion_tipo" value="nueva" class="input-direccion">
            Ingresar nueva direcci√≥n
        </label>

        <div id="campo-nueva-direccion" class="hidden">
            <br>
            <input type="text" id="direccion_nueva" placeholder="Escribe tu nueva direcci√≥n aqu√≠" class="campo-input">
        </div>

        <!-- Campo oculto que se enviar√° al servidor -->
        <input type="hidden" name="direccion_final" id="direccion_final">
    </div>


    <form method="POST" action="{% url 'finalizar_pedido' %}">
        {% csrf_token %}

        <input type="hidden" name="metodo_pago" id="metodo_pago_final">
        <input type="hidden" name="metodo_entrega" id="metodo_entrega_final">

        <button id="btn-finalizar" class="finalizar-pedido" disabled>
            Finalizar Compra
        </button>
    </form>

</div>
{% else %}
<p class="mensaje">Tu carrito est√° vac√≠o.</p>
{% endif %}

{% endblock %}
